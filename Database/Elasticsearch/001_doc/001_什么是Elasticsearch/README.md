# 什么是Elasticsearch

1. You know, for search (and analysis)

2. ES是弹性堆栈核心的分布式搜索和统计引擎。Logstash and Beats 有助于收集，聚合和丰富你的数据并且存储数据到ES中。Kibana 能够使您交互性的探索，可视化，共享对于数据的洞察，并管理和监视堆栈。ES是索引，搜索和分析魔术发生的地方

3. ES提供近乎实时搜索和分析对于所有类型的数据，无论是结构化或者非结构化数据，数字数据或者地址空间数据，ES能够有效的存储并且构建能够支持快速搜索的索引。您不止能简单的检索数据，还能够聚合信息并且发现趋势和关联在您的数据中，随着您数据和查询量的增长，ES天然的分布式特性能够使您的部署能够随他无缝的发展

4. 尽管不是所有的问题都是搜索问题，Elasticsearch为处理各种用例中的数据提供了速度和弹性

   * 增加一个搜索框在app或者网站
   * 存储分析日志，指标和安全信息
   * 使用机器学习实时的为你的数据行为构建模型
   * 使用ES作为自动商业工作流的引擎
   * 使用ElasticSearch作为地理信息系统(GIS)管理，集成和分析空间信息。
   * 存储和处理基因数据使用elasticsearch作为生物研究的工具

5. 人们使用搜索的新奇方式一直使得我们感到惊讶。但是无论你的问题是类似与我们列举出来的例子，还是你在使用es解决一个新的问题，在elasticsearch中处理数据，文档和索引的工作方式是一样的

   

## 数据： 文档和索引

1. Elasticsearch是一个分布式文档仓库。Elasticsearch不是将数据存储在一行数据的每一列中， Elasticsearch存储复杂数据结构作为一个序列化的JSON。当你的Elasticsearch集群有多个节点，存储的文档会被分发到整个集群，并且能够立即从任何节点获得。
2. 当一个文档被存储，他被索引并且能够近乎实时的全文检索，(在一秒内)。ES使用了一种称为倒排索引的数据结构，能够支持非常快速的全文检索。倒排索引列出了出现在文档中的每个不同的单词，并且表示了每个单词出现的文档
3. 可以将索引看作时优化的文档集合，每个文档都是字段的集合，字段是包含数据的键-值对。默认情况下，ES索引每个字段中的所有数据，每个索引字段都有一个专门的，优化的数据结构。例如： 文本字段存储在倒排索引中，数字和地理字段存储在BKD树中。使用按字段数据结构组合并返回搜索结果的能力使Elasticsearch如此之快。
4. Elasticsearch还具有无模式的能力，这意味着可以在不显式指定如何处理文档中可能出现的每个不同字段的情况下为文档建立索引。当动态mapping被开启，ES会自动发现和添加字段到索引中。这个默认行为使得索引和探索你的数据变得容易。你只需要开始索引文档，ES会发现并且为你映射合适的ES数据类型。
5. 您比ES会更加了解您的数据以及如何使用它，所以你能够定义规则去控制动态索引，显示的定义索引去完全控制每个字段如何被索引和存储

## 信息输出：搜索和分析

1. 当你使用es作为一个文档仓库，索引文档和他们的源数据，真正的强大之处在于能够轻松访问构建在Apache lunce搜索引擎上的全套搜索功能
2. es提供简单的，容易理解的Rest api, 用于管理集群，索引和数据。

## 搜索你的数据

* ES REST api支持结构化查询， 全文查询，复杂查询已经两者的混合查询。结构化查询类似于SQL查询。全文搜索寻找所有的文档，匹配查询串的，并且返回他们用相关度排序
* 处理搜寻单个术语，还可以执行短语搜索，相似度搜索和前缀所有，可以获得字段完成建议

## 分析你的数据

* ES聚合能够使你构建数据的复杂摘要，了解关键指标，模式和趋势。
* 因为聚合使用了和搜索相同的结构，所以聚合的速度也很快。这能够确保你实时的分析可视化你的数据。你的报表和仪表盘能够随着你的数据实时变化，你能够基于最新的数据制定信息。

* 更重要的是，聚合与搜索请求一起执行，您可以在单个请求中同时对相同数据搜索文档，过滤结果并执行分析。而且由于聚合是在特定搜索的上下文中计算的。

## 可伸缩性，弹性，集群，节点，碎片

* ES被构建是一直可用的，并且能够随着你的需求缩放。因为他原生就是分布的，你能够增加服务区到一个集群，为了增加容量。ES会自动分发你的数据，并且跨越所有节点查询负载。你的应用不需要做任何改变，ES知道如何平衡多节点集群来提供伸缩和高可用。
* 这是怎么做到的？概括的说，ES索引只是一个或多个物理分片的逻辑组。每个分片实际上是一个自包含的索引。通过将索引中的文档分布到多个分片上，并将这些分片分布到多个节点上，Elasticsearch可以确保冗余。 这既可以防止硬件故障，又可以随着节点被增加到集群增加查询容量。随着集群的增长或收缩，ES可以自动的迁移分片再平衡集群。
* 一种由两种类型的分片： 主分片和副本分片。 索引中的每个文档属于一个主分片。副本分片是主分片的拷贝。副本分片提供数据的冗余备份。
* 一个索引的主分片数量是固定的在索引被创建时，但是副本分片的数量能够被实时的改变，不需要打断索引或者查询操作。

## 视情况而定

* 关于分片大小和为索引配置的主分片数量，存在需要性能方面的考虑和权衡
  * 碎片越多，就需要越多的花销在维护这些索引上。
  * 越大的分片大小， 就需要更多的时间花销当集群再平衡时移动分片
  * 查询许多小分片使得每个分片的处理快捷，但是更多的查询意味着更多的花销。所以也可能查询一个大的分片会更快，这些需要视情况而定
* 作为一个起始点
  * 致力于保持平均分片数量在数GB到数十GB， 一些基于时间的分片，通常的分片大小是20G到40G
  * 避免大量分片问题，一个节点的分片数量能够正比于可用堆空间，作为一个通用规则，每GB堆空间分片数目应该小于20

## 灾难案例

* 为了性能的原因，一个集群中的所有节点需要在一个相同的网络中，平衡一个集群中跨越多个节点的分片在不同的数据中心通常会花费很长的时间。但是高可用架构建议不要把鸡蛋放在一个篮子里。当一个位置发生重大故障时，另一个位置的服务需要能够无缝接管 
  * Cross - cluster replication (CCR):  跨集群复制
* CCR 提供了一种方式自动的同步索引从主集群到另外远程集群，并且能够提供服务作为热备份。
* 跨集群复制是主备复制。主集群上的索引是活动领导索引，并处理所有写请求。复制到次要集群的索引是只读的追随者。