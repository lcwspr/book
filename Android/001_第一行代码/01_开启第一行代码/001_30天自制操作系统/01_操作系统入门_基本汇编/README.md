# # 从计算机结构到汇编程序入门

## 先上手

* 输入指定的指令码，使用计算机输出hello world!

## 究竟做了什么

1. 电脑的结构
   * 电脑的处理中心是CPU: central process unit
   *  不过这个CPU除了与别的电路进行电信号交换以外什么都不会，并且他只能理解开(on), 关(off)两种状态
   * CPU只负责处理一段电信号，这段二进制数可能是一幅画，一段音乐旋律，可能是文章中的一段文字
2. cpu的发展
   * 最早发明计算机只是为了处理电信号
   * 但人们发现，一旦把电信号的开关和数字0和1对应起来，就能进行二进制数和电信号的转换。
   * 之后依次发现了将文字，图形，音乐转换成二进制，最终转换成二进制的方式，使得cpu的应用
   * 而且我们能用CPU来处理的并不仅仅只有数据，还可以用电信号向CPU发出指令。其实我们所编写的程序最终都要转换成所谓的机器语言(能够通过电信号形式发送给CPU)。
     * 这些机器语言就是一连串指令代码，实际上就是０和１的组合

## 汇编相关

1. 可以使用DB指令来定义数据.
   * define byte的缩写,就是往文件里面写入1字节的指令
2. RESB指令: `reserve byte`
   * 如果想要从现在的地址开始,空出10个字节,那么就可以写成`RESB 10`, 不仅仅是把指定的地址空出来,还会在空出来的地址自动填入0x00

## 汇编代码初步

1. FAT12格式软盘启动代码

   ```
   ; hello-os
   ; TAB=4
   
   ; 以下这段是标准FAT12格式软盘专用代码
   
   		DB		0xeb, 0x4e, 0x90
   		DB		"HELLOIPL"		; 启动区的名称可以是任意的字符串8字节
   		DW		512				; 每个扇区(sector)的大小-必须512
   		DB		1				; 簇(cluster)的大小,必须1个扇区
   		DW		1				; FAT的起始位置,一般第一个扇区开始
   		DB		2				; FAT的个数(必须为2)
   		DW		224				; 根目录的大小(一般设成224项)
   		DW		2880			; 该磁盘的大小(必须是2880扇区)
   		DB		0xf0			; 磁盘种类(必须是0xf0)
   		DW		9				; FAT的长度(必须是9扇区)
   		DW		18				; 一个磁道有几个扇区(必须是18)
   		DW		2				; 磁头数(必须是2)
   		DD		0				; 不使用分区,必须是0
   		DD		2880			; 重写一次磁盘大小
   		DB		0,0,0x29		; 意义不明,固定
   		DD		0xffffffff		; 可能是卷标号码
   		DB		"HELLO-OS   "	; 磁盘的名称(11字节)
   		DB		"FAT12   "		; 磁盘格式名称(8字节)
   		RESB	18				; 先空出18字节
   
   ; 程序主体
   
   		DB		0xb8, 0x00, 0x00, 0x8e, 0xd0, 0xbc, 0x00, 0x7c
   		DB		0x8e, 0xd8, 0x8e, 0xc0, 0xbe, 0x74, 0x7c, 0x8a
   		DB		0x04, 0x83, 0xc6, 0x01, 0x3c, 0x00, 0x74, 0x09
   		DB		0xb4, 0x0e, 0xbb, 0x0f, 0x00, 0xcd, 0x10, 0xeb
   		DB		0xee, 0xf4, 0xeb, 0xfd
   
   ; 信息显示部分
   
   		DB		0x0a, 0x0a		; 2个换行
   		DB		"hello, world"
   		DB		0x0a			; 换行
   		DB		0
   
   		RESB	0x1fe-$			; 填写0,知道0x001fee
   
   		DB		0x55, 0xaa
   
   ; 以下是启动区以外部分的输出
   
   		DB		0xf0, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00
   		RESB	4600
   		DB		0xf0, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00
   		RESB	1469432
   
   ```

2. 解析
   1. 使用`;`能够定义注释
   2. DB指令中,我们能够直接使用字符串,写字符串时,汇编指令会自动查找字符串中每一个字符所对应的编码,然后把他们一个字节一个字节的排列起来
   3. DW和DD指令
      1. DW: define word, 8位
      2. DD: define double-world, 16位
   4. $伪指令,
      * 代表当前这一行的字节数(一种用途)
      * `RESB 0x1fe-$`: $为132, 因此使用0x1fe-132, 得出字节数

## ## 几个专业术语

1. TAB=4
   * 有的文本编辑器可以调整TAB的宽度
2. FAT12格式
   * (FAT12 Format), 用Windows或MS-DOS格式化出来的软盘就是这种格式,兼容性好
3. 启动区
   * (boot sector)软盘第一个扇区称之为启动区,
   * 计算机读取软盘时,并不按照一字节一字节的读取,而是512字节为一个单位进行读取(软盘空间为1440kb, 512*2880)
   * 计算机首先读取软盘第一个分区, 然后检查这个扇区最后两个字节的内容,如不是`0x55AA`, 计算机认为这张软盘没有启动程序, 如果最后两个字节刚好`0x55AA`那么就会认为扇区的开头是启动程序,开始执行这个程序.
4. IPL
   * initial program loader(启动程序加载器), 启动区只有512字节,实际操作系统根本不够用, 所以几乎所有操作系统,都是把加载操作系统本身的程序放入启动区
5. 启动
   * (bootstrap), 
   * 磁盘上分明装有操作系统,并且读入操作系统的程序(IPL)也放在磁盘上(就像打开宝箱的要是在宝箱里 -- 矛盾的机制)