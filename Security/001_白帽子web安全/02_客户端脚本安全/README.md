# 客户端脚本安全

## 同源策略

* 同源策略(Same Origin Policy)是一种约定，是浏览器最核心也是最基本的安全功能。可以说Web是构建在同源策略的基础之上的
* ***浏览器的同源策略，限制了来自不同源的document或脚本，对于当前document读取或设置某些属性。***
* 影响源的因素有
  * host(域名或IP地址，IP地址看作根域名)
  * 子域名
  * 端口
  * 协议
* 需要注意： 对于当前页面来说，页面内存放JavaScript文件的域并不重要，重要的是加载JavaScript页面所在的域是什么
  * 浏览器中， script, img, iframe, link都可以跨域加载资源，不受到同源策略的限制
  * 而ajax会受到同源策略的影响，浏览器限制了js权限，使其不能读写返回的内容
  * 如果ajax能够跨域访问资源，那么CSRF的token可能会泄露
* 跨域请求需求很迫切，所以w3c制定了ajax跨域访问标准。需要通过目标域返回的HTTP头来授权是否允许跨域访问。
  * 信任基础在于： JavaScript无法控制HTTP头

## 浏览器沙箱

* 在网页中插入一段 恶意代码，利用浏览器漏洞执行任意代码的攻击方式。被称为 “挂马”
* 浏览器的多进程架构，将浏览器的各个功能模块分开，当一个进程崩溃不会影响到其他进程。(每个标签页为一个进程，崩溃局限于当前标签页)
  * Chrome是第一个采取多进程架构的浏览器
  * 主要进程分为： 浏览器进程，渲染进程，插件进程，拓展进程
  * sandbox: 资源隔离类模块： 为了让不可信任的代码运行在一定的环境中， 限制不可信任的代码访问隔离区之外的资源，如果一定要跨过sandbox, 必须通过指定的数据通道

## 恶意网站拦截

